!function(){"use strict";const e={displayModes:{DESKTOP:0,MOBILE:1}},t={websocket:!1,client:{interval:5e3,targetUrl:"https://heatmap.services",clientVersion:2,error:{timeout:1e4,maxOccurrence:3},trackers:{eventsList:["onclick","onmousemove","onscroll"],mouseMoveTimeout:80},windowProperties:{normalMobileWidth:400}}},i=window._debugMode,o=400,n=768,s=620,r=960;function a(e){const t=[],i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<e;o+=1)t.push(i.charAt(Math.floor(Math.random()*i.length)));return t.join("")}function l(e,t){let i;return(...o)=>{clearTimeout(i),i=setTimeout(()=>e(...o),t)}}function d(e){const{innerWidth:t,__page_generator:o,__config:r,__mobile_version:a}=e;if(o){const e=r&&r.mobileDisabled;return i&&console.log("isMobileMode PG:",!e&&t<n,t,n),!e&&t<n}return i&&console.log("isMobileMode",a&&t<n,t,n),a&&t<s}function h(e){return e.scrollY||e.document.scrollTop||e.document.body.scrollTop||0}class c{constructor(e){this.ajaxPath="/api/raw-data",this.websocketPath="/ws/raw-data",this.options=e,this.useBeacon=!1}getFullRESTPath(){return this.options.targetUrl+this.ajaxPath}sendByAjax(e){return fetch(this.getFullRESTPath(),{method:"POST",headers:{connection:"keep-alive"},body:JSON.stringify(e)}).then(e=>e.ok?Promise.resolve(e):Promise.reject(e))}sendByBeacon(e){if(navigator&&navigator.sendBeacon){const t=this.getFullRESTPath();try{return navigator.sendBeacon(t,JSON.stringify(e)),Promise.resolve()}catch(t){return this.sendByAjax(e)}}return this.sendByAjax(e)}send(e){return this.useBeacon?this.sendByBeacon(e):this.sendByAjax(e)}}class p{constructor(e){this.pixelRatio=1,this.isMobileModeOn=d(e.window),this.options=e,this.isPopupOpened=!1,this.popupId=!1,this.errorCount=0,this.sendTimestamp=0,this.enableSend=!0,this.request=new c(e),this.sentScrollDesktop=0,this.sentScrollMobile=0,this.currentMaxScrollDesktop=0,this.currentMaxScrollMobile=0,this.storage=[],this.singleSessionStorage={},this.resetStorage()}resetStorage(){this.singleSessionStorage.mousemove=[],this.singleSessionStorage.click=[]}wrapDataToSend(e){return{displayMode:this.displayMode,sessionId:this.options.sessionId,pageId:this.options.pageId,version:this.options.pageVersion,variation:this.options.pageVariation,variationHash:this.options.pageVariationHash,popupId:this.popupId,clientVersion:this.options.clientVersion,data:e}}checkForDisplayModeChange(){this.displayMode?(this.isMobileModeOn||this.addDataToStorage(),this.isMobileModeOn=!0):(this.isMobileModeOn&&this.addDataToStorage(),this.leftEdgeElement||this.findEdgeElements(),this.isMobileModeOn=!1)}isPointInBoundaries({x:e,y:t}){const{leftMargin:i,topMargin:o,width:n,height:s}=this;return i<e&&i+n>e&&o<t&&o+s>t}findEdgeElements(){const{innerSection:e,options:{isPageGenerator:t,window:{document:{body:i,body:{clientWidth:o}}}}}=this;let[n,s]=[o,0],r=[];r=t?i.getElementsByTagName("main").item(0).getElementsByClassName("widget"):i.getElementsByClassName("block-inner");for(let e=0;e<r.length;e++){const t=r.item(e),{left:i,right:o,width:a}=t.getBoundingClientRect();a&&n>i&&(n=i,this.leftEdgeElement=t),a&&s<o&&(s=o,this.rightEdgeElement=t)}if(r.length){const{left:t,right:i}=e.getBoundingClientRect();n>t&&(this.leftEdgeElement=e),s<i&&(this.rightEdgeElement=e)}else this.leftEdgeElement=e,this.rightEdgeElement=e;this.leftEdgeElement||(this.leftEdgeElement=e),this.rightEdgeElement||(this.rightEdgeElement=e),this.leftEdgeElement||(this.enableSend=!1)}findInnerSection(){const{isPageGenerator:e,window:{document:{body:t}}}=this.options,i=e?"section-inner":"block-inner",o=[...t.getElementsByClassName(i)];this.innerSection=o.find(e=>e.clientWidth),this.innerSection||(this.enableSend=!1)}updateHeatmapDivBoundaries(){const{isPageGenerator:t,heatmapDiv:n,window:{innerWidth:s,scrollX:a,scrollY:l,document:{body:{offsetHeight:h}}}}=this.options;let c,p,g,u,m,w=0;if(this.displayMode=function(t){return e.displayModes[d(t)?"MOBILE":"DESKTOP"]}(window),this.checkForDisplayModeChange(),this.setMaxScroll(),this.isMobileModeOn){const{width:e,left:t}=this.innerSection.getBoundingClientRect();u=e,c=t,g=h}else c=this.leftEdgeElement.getBoundingClientRect().left,g=h,u=(p=this.rightEdgeElement.getBoundingClientRect().right)-c;if(this.isPopupOpened){const{left:e,right:t,height:i,width:o,top:n}=this.popupElement.getBoundingClientRect();c=e,w=n+l,p=t,g=i,u=o}if(c+=a,t)if(m=c,this.isMobileModeOn)this.pixelRatio=s<o?o/s:1;else{const{width:e}=this.innerSection.getBoundingClientRect();this.pixelRatio=r/e}else m=c>0?c:0;i&&console.log("Pixel ratio:",this.pixelRatio),this.leftMargin=m,this.topMargin=w,this.width=u,this.height=g,n.style.left=`${m}px`,n.style.width=`${u}px`,n.style.height=`${g}px`,n.style.top=`${w}px`}addPointToStorage(e,t,o){const{leftMargin:n,topMargin:s,pixelRatio:r,height:a,width:l}=this,d=t-n,h=o-s;d<0||h<0||d>l||h>a||!r||(i&&"click"===e&&(console.log("addPointToStorage:",d,h,n,s,l,a),console.log("with pixelRatio:",Math.round(d*r),Math.round(h*r))),this.singleSessionStorage[e].push({x:Math.round(d*r),y:Math.round(h*r)}))}setMaxScroll(){const{displayMode:e,currentMaxScrollMobile:t,currentMaxScrollDesktop:o,height:n,options:{window:s}}=this,r=Math.floor(h(s)+s.innerHeight),a=Math.floor(n),l=r>a?a:r;e&&t<l?this.currentMaxScrollMobile=l:!e&&o<l&&(this.currentMaxScrollDesktop=l),i&&console.log("setMaxScroll:::","displayMode:",e,"scroll:",l,"currentMaxScrollMobile",this.currentMaxScrollMobile,"currentMaxScrollDesktop",this.currentMaxScrollDesktop)}addDataToStorage(){const{currentMaxScrollMobile:e=0,currentMaxScrollDesktop:t=0,displayMode:i,sentScrollMobile:o,sentScrollDesktop:n,pixelRatio:s}=this,r=Math.floor((i?e:t)*s),a=i?o:n,l=[];if(this.singleSessionStorage.mousemove.length&&l.push({eventName:"mousemove",data:this.singleSessionStorage.mousemove}),this.singleSessionStorage.click.length&&l.push({eventName:"click",data:this.singleSessionStorage.click}),r&&a<r&&(l.push({eventName:"scroll",data:[{y:r}]}),i?this.sentScrollMobile=r:this.sentScrollDesktop=r),this.resetStorage(),l.length){const e=this.wrapDataToSend(l);this.storage.push(e)}}sendBeacon(){if(this.addDataToStorage(),this.storage.length){const e=this.storage.shift();this.request.send(e)}}sendData(){if(this.enableSend&&this.storage.length&&Date.now()>this.sendTimestamp){const e=this.storage.shift();this.request.send(e).then(()=>{this.errorCount=0}).catch(t=>{console.error(t);const{options:{error:i}}=this;this.errorCount+=1,this.errorCount<i.maxOccurrence?this.sendTimestamp=Date.now()+i.timeout:this.enableSend=!1,this.storage.push(e)})}}init(){this.isMobileModeOn=d(this.options.window),this.findInnerSection(),this.isMobileModeOn||this.findEdgeElements(),this.updateHeatmapDivBoundaries(),this.resetStorage(),this.setMaxScroll(),setInterval(()=>{this.addDataToStorage(),setTimeout(()=>{this.sendData()},this.options.interval/2)},this.options.interval)}}function g(){if(!window.__preview){const{__variant:o,__variant_hash:n,__version:s,__page_id:r,__page_generator:c,__workspaceWidth:g=960,__page_domain:u,location:{href:m}}=window;(!u||u&&-1===m.indexOf(u.replace("//","")))&&console.log("HEATMAP EVENTS COLLECTING BLOCKED");const{websocket:w,client:{targetUrl:M,interval:S,error:E,windowProperties:f,clientVersion:y,trackers:v}}=t;if(function(e,t){return!!t&&t.includes(e)}(`${n}:${e.displayModes[d(window)?"DESKTOP":"MOBILE"]}`,window.__predator_blacklist))return;const b=document.createElement("div");i&&document.body.appendChild(b);const x={window:window,heatmapDiv:b,pageVariationHash:n,interval:S,error:E,pageId:r,pageVersion:s,targetUrl:M,windowProperties:f,workspaceWidth:g,trackers:v,isPageGenerator:c,clientVersion:c?3:y,pageVariation:o.split("-")[0],sessionId:a(12),websocket:"true"===w||!0===w},D=new p(x);window._htmp=D;const T=/iPhone|iPad/i.test(window.navigator.userAgent);let B=!1;const k=()=>{B||(D.request.useBeacon=!0,D.sendBeacon()),B=!0};i&&(b.setAttribute("id","heatmapDiv"),b.style.position="absolute",b.style.top="0px",b.style.left="0px",b.style.opacity=0,b.style.background="green",b.style.zIndex=1);const P=function(e,t){let i=0;return function(...o){const n=(new Date).getTime();if(!(n-i<e))return i=n,t(...o)}}(v.mouseMoveTimeout,D.addPointToStorage.bind(D)),_=({type:e,pageX:t,pageY:o,clientX:n,clientY:s})=>{const r=h(window),a=function(e){return e.scrollX||e.document.scrollLeft||e.document.body.scrollLeft||0}(window);let l,d;if(null==t||null==o){const{documentElement:{clientLeft:e,clientTop:t},body:{clientLeft:i,clientTop:o}}=document;l=n+a-(e||i||0),d=s+r-(t||o||0)}else l=t,d=o;D.isPointInBoundaries({x:l,y:d})&&("mousemove"!==e||D.isMobileModeOn&&T?"click"===e&&(D.addPointToStorage(e,l,d),i&&(console.log("mouse click event",l,d),console.log("SIZE:","heatmapDiv.width:",b.style.width,"window.outerWidth",window.outerWidth,"heatmapDiv.style.height",b.style.height,"window.outerHeight",window.outerHeight))):P(e,l,d))},O=()=>{D.isPopupOpened&&D.updateHeatmapDivBoundaries()};let I;const C=e=>{const{id:t,popup:o}=e.detail;D.addDataToStorage();const n=c?o.getElementsByClassName("lightbox-content")[0]:o.getElementsByClassName("popup-inner")[0];D.popupId=t,D.isPopupOpened=!0,D.popupElement=n,i&&(b.style.zIndex=10500001),setTimeout(()=>{(I=n.parentElement).addEventListener("scroll",O),D.updateHeatmapDivBoundaries()},500)},L=()=>{I.removeEventListener("scroll",O),D.addDataToStorage(),i&&(b.style.zIndex=1),D.popupId=!1,D.isPopupOpened=!1,setTimeout(()=>{D.updateHeatmapDivBoundaries()},c?1:200)},R=()=>{D.setMaxScroll()};D.init(document.body.firstElementChild),window.addEventListener("preview.popup.shown",e=>setTimeout(()=>C(e))),window.addEventListener("preview.popup.hide",e=>setTimeout(()=>L(e))),window.addEventListener("resize",l(D.updateHeatmapDivBoundaries.bind(D),350)),window.addEventListener("scroll",l(R.bind(this),100)),window.document.addEventListener("mousemove",_,!0),window.document.addEventListener("click",_,!0),i&&window.addEventListener("keyup",e=>{"h"===e.key?b.style.opacity=0:"s"===e.key&&(b.style.opacity=.3)}),window.addEventListener("beforeunload",k.bind(this)),window.addEventListener("unload",k.bind(this))}}"complete"===document.readyState?g():window.addEventListener("load",g)}();
